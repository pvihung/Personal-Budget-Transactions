{% extends 'base.html' %}
{% block title %}Add Record â€” In My Pocket{% endblock %}

{% block content %}
    <div>
        {% if error %}
            <div class="message error">{{ error }}</div>
        {% endif %}
        {% if success %}
            <div class="message success">{{ success }}</div>
        {% endif %}
    </div>

    <div>
        <h1>Add Record for {{ user.user_name if user else 'user' }}</h1>
        <form method="POST" action="{{ url_for('add_records') }}">
            <label for="record_type">Record type</label>
            <select id="record_type" name="record_type">
                <option value="Expense" {% if record and record.record_type =='Expense' %}selected{% endif %}>Expense</option>
                <option value="Income" {% if record and record.record_type =='Income' %}selected{% endif %}>Income</option>

            </select>

            <label for="category">Category</label>
            <select id="category" name="category">
                <option value="" {% if not record or not record.category %}selected{% endif %}>Select category</option>
                <option value="childcare" {% if record and record.category =='childcare' %}selected{% endif %}>childcare</option>
                <option value="education" {% if record and record.category =='education' %}selected{% endif %}>education</option>
                <option value="entertainment" {% if record and record.category =='entertainment' %}selected{% endif %}>entertainment</option>
                <option value="freelance" {% if record and record.category =='freelance' %}selected{% endif %}>freelance</option>
                <option value="gift" {% if record and record.category =='gift' %}selected{% endif %}>gift</option>
                <option value="groceries" {% if record and record.category =='groceries' %}selected{% endif %}>groceries</option>
                <option value="healthcare" {% if record and record.category =='healthcare' %}selected{% endif %}>healthcare</option>
                <option value="insurance" {% if record and record.category =='insurance' %}selected{% endif %}>insurance</option>
                <option value="investment" {% if record and record.category =='investment' %}selected{% endif %}>investment</option>
                <option value="lottery" {% if record and record.category =='lottery' %}selected{% endif %}>lottery</option>
                <option value="miscellaneous" {% if record and record.category =='miscellaneous' %}selected{% endif %}>miscellaneous</option>
                <option value="pension" {% if record and record.category =='pension' %}selected{% endif %}>pension</option>
                <option value="rent" {% if record and record.category =='rent' %}selected{% endif %}>rent</option>
                <option value="rental_income" {% if record and record.category =='rental_income' %}selected{% endif %}>rental_income</option>
                <option value="salary" {% if record and record.category =='salary' %}selected{% endif %}>salary</option>
                <option value="side_job" {% if record and record.category =='side_job' %}selected{% endif %}>side_job</option>
                <option value="transportation" {% if record and record.category =='transportation' %}selected{% endif %}>transportation</option>
                <option value="utilities" {% if record and record.category =='utilities' %}selected{% endif %}>utilities</option>
            </select>

            <div class="row">
                <div>
                    <label for="amount">Amount</label>
                    <input id="amount" type="number" step="0.01" min="0" name="amount" placeholder="Amount" value="{{ record.amount if record and record.amount is not none else '' }}">
                </div>
                <div>
                    <label for="currency">Currency</label>
                    <input id="currency" type="text" name="currency" placeholder="Currency" value="{{ record.currency if record and record.currency else 'USD' }}">
                </div>
            </div>

            <label for="transaction_date">Transaction date</label>
            <input id="transaction_date" type="date" name="transaction_date" value="{% if record and record.transaction_date %}{% if record.transaction_date.isoformat is defined %}{{ record.transaction_date.isoformat() }}{% elif record.transaction_date.strftime is defined %}{{ record.transaction_date.strftime('%Y-%m-%d') }}{% else %}{{ record.transaction_date }}{% endif %}{% endif %}">

            <label for="payment_method">Payment method</label>
            <select id="payment_method" name="payment_method">
                <option value="" {% if not record or not record.payment_method %}selected{% endif %}>Select payment method</option>
                <option value="bank_transfer" {% if record and record.payment_method =='bank_transfer' %}selected{% endif %}>Bank transfer</option>
                <option value="cash" {% if record and record.payment_method =='cash' %}selected{% endif %}>Cash</option>
                <option value="credit_card" {% if record and record.payment_method =='credit_card' %}selected{% endif %}>Credit card</option>
                <option value="debit_card" {% if record and record.payment_method =='debit_card' %}selected{% endif %}>Debit card</option>
            </select>

            <div style="margin-top:12px; display:flex; gap:8px;">
                <button class="btn" type="submit">Add Record</button>
                <a class="btn secondary" href="{{ url_for('user_page') }}" style="align-self:center; text-decoration:none;">Back to profile</a>
            </div>
        </form>

        {% if record %}
            <h3>Last added record</h3>
            <div>
                <strong>Type:</strong> {{ record.record_type }}<br>
                <strong>Category:</strong> {{ record.category }}<br>
                <strong>Amount:</strong> {{ record.amount }} {{ record.currency }}<br>
                <strong>Date:</strong>
                {% if record.transaction_date %}
                    {% if record.transaction_date is string %}
                        {{ record.transaction_date }}
                    {% elif record.transaction_date.strftime is defined %}
                        {{ record.transaction_date.strftime('%Y/%m/%d') }}
                    {% else %}
                        {{ record.transaction_date }}
                    {% endif %}
                {% endif %}<br>
                <strong>Payment:</strong> {{ record.payment_method }}<br>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block scripts %}
<script>
// No recurrence controls anymore
</script>
{% endblock %}
