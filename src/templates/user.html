{% extends "base.html" %}

{% block title %}User Page{% endblock %}

{% block content %}
<div>
    {% if error %}
        <div class="message error">{{ error }}</div>
    {% endif %}
    {% if success %}
        <div class="message success">{{ success }}</div>
    {% endif %}

    <h1>Welcome {{ user_details.user_name }}!</h1>

    <ul>
        <li><strong>Email:</strong> {{ user_details.email or 'N/A' }}</li>
        <li><strong>Household size:</strong> {{ user_details.household_size or 'N/A' }}</li>
        <li><strong>City:</strong> {{ user_details.location_city or 'N/A' }}</li>
        <li><strong>State:</strong> {{ user_details.location_state or 'N/A' }}</li>
        <li><strong>Postal code:</strong> {{ user_details.location_postal_code or 'N/A' }}</li>
        <li><strong>Country:</strong> {{ user_details.location_country or 'N/A' }}</li>
    </ul>

    <form method="POST">
        {# Determine whether details exist in DB #}
        {% set details_present = (user_details.email is not none) or (user_details.household_size is not none) or (user_details.location_city is not none) or (user_details.location_state is not none) or (user_details.location_postal_code is not none) or (user_details.location_country is not none) %}

        {# Prefer the force_add_profile flag if provided by the view (set on signup) #}
        {% set force_add = (force_add_profile is defined and force_add_profile) %}

        {% if force_add %}
            <div class="meta">Please add your profile details to complete account setup.</div>
        {% endif %}

        <div class="controls">
            {% if not details_present or force_add %}
                <button class="btn" type="submit" name="action_button" value="edit_data">Add User data</button>
            {% else %}
                <button class="btn" type="submit" name="action_button" value="update_details">Update details</button>
            {% endif %}

            <div class="actions">
                <button class="btn" type="submit" name="action_button" value="add_record">Add Records</button>
                <button class="btn secondary" type="submit" name="action_button" value="view_records">View Records</button>
                <button class="btn secondary" type="submit" name="action_button" value="dashboard">Dashboard</button>
                <button class="btn secondary" type="submit" name="action_button" value="logout">Log Out</button>
                <button class="btn secondary" type="submit" name="action_button" value="change_password">Forgot or Change Password</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}
